/**
 * @fileoverview Firestore Security Rules for VoltaView Auth application.
 *
 * Core Philosophy:
 * This ruleset enforces a strict user-ownership model for both user profiles and ESP32 data.
 * Users can only read and write their own data.
 *
 * Data Structure:
 * - `/users/{userId}`: Stores user profile information. 'userId' must match the Firebase Auth UID.
 * - `/users/{userId}/esp32_data/{esp32DataId}`: Stores ESP32 sensor data for a specific user.
 *
 * Key Security Decisions:
 * - User listing is disallowed.
 * - All write operations are strictly controlled by user ID to prevent unauthorized data modification.
 *
 * Denormalization for Authorization:
 * The data structure itself enforces authorization. The `userId` in the path `/users/{userId}/esp32_data/{esp32DataId}`
 * is used to ensure that only the owner can access the data, avoiding the need for additional `get()` calls.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Rule for testing whether the app is reading from the esp32 without authentication.  All read and write access is granted.
     * @path /users/{userId}
     * @allow (get, list, create, update, delete) - Any user can perform any operation.
     * @deny This rule does not deny any operations as it is intended for testing.
     * @principle Allows all operations for testing purposes.
     */
    match /users/{userId} {
      allow get, list, create, update, delete: if true;
    }

    /**
     * @description Rule for testing whether the app is reading from the esp32 without authentication.  All read and write access is granted.
     * @path /users/{userId}/esp32_data/{esp32DataId}
     * @allow (get, list, create, update, delete) - Any user can perform any operation.
     * @deny This rule does not deny any operations as it is intended for testing.
     * @principle Allows all operations for testing purposes.
     */
    match /users/{userId}/esp32_data/{esp32DataId} {
      allow get, list, create, update, delete: if true;
    }
  }
}