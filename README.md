# VoltaView - Smart Solar Microgrid Management Dashboard

VoltaView is a comprehensive, real-time dashboard for monitoring and managing a decentralized solar microgrid. Built with Next.js and Firebase, it provides a powerful interface for tracking energy generation, consumption across multiple communities, and system health. The application leverages AI for predictive maintenance alerts and insightful performance reports.

![VoltaView Dashboard](https://storage.googleapis.com/stedi-assets/volta-view-screenshot.png)

## Key Features

*   **Real-Time Monitoring:** Live data streams from ESP32 microcontrollers show vital metrics like power output, battery state of charge (SOC), solar irradiance, and more.
*   **Community Dashboards:** Dedicated pages for each community ("Community A", "B", "C") provide granular insights into their specific energy consumption and node status.
*   **AI-Powered Predictive Maintenance:** An integrated Genkit AI flow analyzes incoming sensor data to generate predictive alerts for potential issues like high battery temperatures or inverter underperformance.
*   **Automated Reporting:** Generate AI-summarized reports on grid performance over time, identifying trends and key events.
*   **ESP32 Integration Guide:** A dedicated page provides the complete, robust firmware needed to connect an ESP32 sensor array to the platform, including hardware pinouts and cloud configuration.
*   **System Health Overview:** A central dashboard provides a high-level view of all system components, from the PV array to the battery bank and inverter.
*   **Dark/Light Mode:** A modern, customizable interface with support for multiple themes.

## Technology Stack

*   **Framework:** [Next.js](https://nextjs.org/) (App Router)
*   **Hosting:** [Firebase App Hosting](https://firebase.google.com/docs/app-hosting)
*   **Database:** [Firestore](https://firebase.google.com/docs/firestore) for historical data logging and alerts.
*   **Authentication:** [Firebase Authentication](https://firebase.google.com/docs/auth) (Email/Password & Anonymous)
*   **AI/Generative:** [Genkit (via Google AI)](https://firebase.google.com/docs/genkit) for AI flows and report generation.
*   **UI Components:** [ShadCN UI](https://ui.shadcn.com/)
*   **Styling:** [Tailwind CSS](https://tailwindcss.com/)
*   **Charting:** [Recharts](https://recharts.org/)
*   **Hardware:** ESP32 Microcontroller

## Architecture

### Frontend

The frontend is built using the Next.js App Router, which enables a fast, server-rendered experience. 

-   **`src/app/`**: Contains all pages and layouts. Each route (e.g., `/dashboard`, `/community-a`) has its own `page.tsx` file.
-   **`src/components/`**: Houses all reusable React components, including UI elements from ShadCN, charts, and custom dashboard widgets.
-   **`src/firebase/`**: Contains all Firebase-related client-side code, including initialization, custom hooks for data fetching (`useCollection`, `useDoc`), and the authentication provider.

### Backend & Data Model

The backend is entirely serverless, leveraging Firebase services.

-   **Firestore:** Serves as the primary database. The structure is defined in `docs/backend.json`:
    -   `/users/{userId}`: Stores user profile information.
    -   `/users/{userId}/esp32_data`: A time-series collection storing sensor readings from each community's ESP32. The dashboard queries the latest document from this collection for the "live" view.
    -   `/alerts`: Stores predictive maintenance alerts generated by the AI flow.
-   **Firebase Authentication:** Manages user accounts. The system is pre-configured with three community-specific users (`user1@volta.view`, etc.) for the ESP32 to authenticate with.
-   **Firestore Security Rules:** The `firestore.rules` file ensures that users can only read and write to their own data paths, providing a secure, multi-tenant architecture.

### AI Integration

AI features are powered by **Genkit**, Google's framework for building production-ready AI applications.

-   **`src/ai/flows/`**: Contains the server-side AI logic.
    -   **`derive-metrics-flow.ts`**: Analyzes real-time sensor data to identify conditions for predictive maintenance alerts. It is triggered by the `AiAlertEngine` component on the frontend.
    -   **`generate-report-summary-flow.ts`**: Takes a time series of grid data and generates a natural language summary for the reports page.

### ESP32 Firmware

The application includes a dedicated page (`/esp32`) with the complete and final C++ firmware for the ESP32 microcontroller. This firmware is designed to be robust and includes:
-   WiFi connection and reconnection logic.
-   Authentication against Firebase using pre-defined community user accounts.
-   Sensor reading logic for all connected hardware (`EmonLib`, `DallasTemperature`, etc.).
-   Data payload creation and POST requests to the Firestore REST API.
-   A software fix to disable the brownout detector, ensuring stability on less reliable power sources.

## Getting Started

### Prerequisites

*   Node.js (v18 or later)
*   An active Google account for Firebase.
*   A Gemini API Key for the AI features.

### 1. Set Up Firebase Project

1.  Go to the [Firebase Console](https://console.firebase.google.com/) and create a new project.
2.  In your project, go to the **Authentication** section, click "Get Started," and enable the **Email/Password** provider.
3.  Go to the **Firestore Database** section and create a new database in production mode.
4.  Navigate to **Project Settings** > **General**. Under "Your apps," create a new **Web app**.
5.  Copy the `firebaseConfig` object provided.

### 2. Configure Local Environment

1.  **Clone the repository:**
    ```bash
    git clone <your-repo-url>
    cd <project-directory>
    ```

2.  **Update Firebase Config:**
    -   Open `src/firebase/config.ts`.
    -   Replace the existing `firebaseConfig` object with the one you copied from your Firebase project.

3.  **Set Up Environment Variables:**
    -   Create a new file named `.env` in the root of the project.
    -   Add your Gemini API key to this file:
        ```
        GEMINI_API_KEY="YOUR_API_KEY_HERE"
        ```

### 3. Install Dependencies & Run the App

1.  **Install NPM packages:**
    ```bash
    npm install
    ```

2.  **Run the development server:**
    ```bash
    npm run dev
    ```

The application will now be running at `http://localhost:9002`.

### 4. Set Up ESP32 Hardware

1.  Navigate to the **ESP32 Connect** page (`/esp32`) in the running web application.
2.  Copy the complete firmware code provided.
3.  Open the code in the Arduino IDE or PlatformIO.
4.  **Important:** In the firmware file, update the `WIFI_SSID` and `WIFI_PASSWORD` constants with your local WiFi network credentials. The Firebase project details are already included.
5.  Flash the firmware to your ESP32 device. Once it connects to your WiFi, it will begin authenticating and sending data to your Firestore database, which will appear on the dashboard.
